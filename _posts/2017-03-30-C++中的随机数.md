---
layout: default
tags: 教程
---

## 使用C的随机数

### 实现

C中*随机数函数*非常简单，定义在`<stdlib.h>`中：

- ```c
  void srand(unsigned seed);
  ```

  将随机种子设为`seed` ；**相同的种子将获得相同的随机数序列**，只要在程序开始初始化即可。

- ```c
  int rand();
  ```

  返回[0,RAND_MAX]之间的**伪随机数**。

### 初始化种子

一般使用`<time.h>`中的`time()`函数

```c
time_t time(time_t* arg);
```

返回当前的*日历时间*，如果`arg`不为空，同时赋给`arg`。

```c
srand(time(NULL));
srand(time(0));
```

```cpp
srand(time(nullptr));
```

> 关于NULL,0,nullptr：在C中推荐使用`NULL`表示空指针，在C++中推荐使用`0`，在C++11中使用`nullptr`更好；在`time()`中可以任意使用。

### 问题

#### 时间问题

- 在`Windows`下，通常`time()`更新为**每秒一次**
- 在`Linux`下，通常`time()`更新为**每毫秒一次**

当使用`Windows`对拍时，问题很严重：**数据每秒才更新一次**。当程序计算很快时，很多组数据无效。

#### 范围问题

- 在`Windows`下，通常`RAND_MAX`为32767($$2^{15}-1$$)
- 在`Linux`下，通常`RAND_MAX`等于`INT_MAX`

#### 演示代码

```cpp
//this code should be compiled <since> C++14
#include<bits/stdc++.h>
using namespace std;
int main()
{
	while(clock()<10*CLOCKS_PER_SEC)
	{
		srand(time(NULL));
		cout<<"\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                                                            \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b";
		for(int i=1;i<=10;i++)
			cout<<rand()<<' ';
		this_thread::sleep_for(100ms);
	}
	return 0;
}
```

**编译说明：编译器必须至少支持C++14！** *若不支持C++11/14，使用`sleep()`代替`this_thread::sleep_for(100ms)`*

该代码将运行大约10秒，展示随机数的更新情况以及随机数的范围。

## 在`Windows`下解决时间问题

### 高精度计时器

在`Windows`下提供了一种高精度计时器，使用`QueryPerformanceCounter`和`QueryPerformanceFrequency`。

高精度计时器一个周期**通常小于1微秒**，该API最低系统要求为`Windows 2000`。

```cpp
BOOL WINAPI QueryPerformanceCounter(
  _Out_ LARGE_INTEGER *lpPerformanceCount
);
```

获取当前的高精度计时器计数，成功则返回非0值。

```cpp
BOOL WINAPI QueryPerformanceFrequency(
  _Out_ LARGE_INTEGER *lpFrequency
);
```

获取高精度计时器的频率。

*待续……*

## 参考文献

1. <http://en.cppreference.com/w/cpp/numeric/random>
2. <https://msdn.microsoft.com/en-us/library/windows/desktop/ms644904(v=vs.85).aspx>;<https://msdn.microsoft.com/en-us/library/windows/desktop/ms644905(v=vs.85).aspx>